<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fold Me If You Can ‚Äì Lab Edition</title>
  <style>
    :root {
      --primary: #00796b;
      --secondary: #004d40;
      --background: #f3f6f9;
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--background);
      margin: 0;
      padding: 0;
      text-align: center;
    }
    h1 {
      margin: 1rem 0 0.5rem;
      color: #2e7d32;
    }
    #tutorial, #score-report {
      background: white;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem auto;
      width: 95%;
      max-width: 600px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .game-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 1rem auto;
      max-width: 600px;
    }
    .amino-acid {
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      cursor: grab;
      user-select: none;
      transition: transform 0.2s ease;
    }
    .amino-acid:hover {
      transform: scale(1.05);
    }
    .hydrophobic { background: #6d4c41; }
    .polar { background: #42a5f5; }
    .acidic { background: #ef5350; }
    .basic { background: #66bb6a; }
    .disulfide { background: #ff9800; }
    .drop-zone {
      width: 90vw;
      max-width: 540px;
      height: 60vw;
      max-height: 540px;
      border: 2px dashed #ccc;
      border-radius: 12px;
      background: white;
      margin: 1rem auto;
      position: relative;
    }
    .dropped {
      position: absolute;
    }
    #controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 1rem;
    }
    #controls button {
      padding: 0.5rem 1rem;
      border: none;
      background: var(--primary);
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    #controls button:hover {
      background: var(--secondary);
    }
    .report-box {
      text-align: left;
      font-family: monospace;
      background: #fdfdfd;
      border-left: 4px solid var(--primary);
      padding: 1rem;
      margin-top: 1rem;
      white-space: pre-wrap;
    }
    #toast {
      visibility: hidden;
      min-width: 200px;
      background-color: #323232;
      color: white;
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      position: fixed;
      z-index: 100;
      left: 50%;
      bottom: 30px;
      transform: translateX(-50%);
      font-size: 1rem;
    }
    #toast.show {
      visibility: visible;
      animation: fadein 0.5s, fadeout 0.5s 2.5s;
    }
    @keyframes fadein {
      from {bottom: 10px; opacity: 0;}
      to {bottom: 30px; opacity: 1;}
    }
    @keyframes fadeout {
      from {bottom: 30px; opacity: 1;}
      to {bottom: 10px; opacity: 0;}
    }
    .bar {
      height: 10px;
      margin: 10px auto;
      max-width: 500px;
      border-radius: 5px;
      background: linear-gradient(to right, #ef5350, #ffeb3b, #66bb6a);
      position: relative;
    }
    .bar::after {
      content: '';
      position: absolute;
      height: 10px;
      width: 5px;
      background: #000;
      left: 50%;
      transform: translateX(-50%);
    }
  </style>
</head>
<body>
  <h1>üß™ Fold Me If You Can</h1>

  <div id="demo">
    <div class="highlight-box">
      <strong>üß¨ Tutorial:</strong>
      <p>Drag and drop amino acids into the fold zone. Match acidic and basic residues to form <strong>salt bridges</strong>. Place two <strong>Cys</strong> residues close together to form <strong>disulfide bonds</strong>. Bury hydrophobics deep in the core and keep polars near the edges!</p>
      <button onclick="runDemo()">‚ñ∂Ô∏è Watch a Perfect Fold</button>
    </div>
  </div>

  <div id="tutorial">
    <p><strong>Goal:</strong> Optimize protein folding by arranging amino acids for best ŒîG, salt bridges, and disulfide bonds!</p>
    <p id="daily-seed"></p>
    <div class="bar" id="score-bar"></div>
  </div>

  <div class="game-container" id="aa-bank"></div>
  <div class="drop-zone" id="dropZone"></div>
  <div id="controls">
    <button onclick="checkStructure()">Check My Fold</button>
    <button onclick="resetGame()">Reset</button>
    <button onclick="nextPuzzle()">Next Puzzle</button>
  </div>
  <div id="score-report"></div>
  <div id="toast">Nice Fold!</div>

  <script>
    const aaBank = document.getElementById('aa-bank');
    const dropZone = document.getElementById('dropZone');
    const report = document.getElementById('score-report');
    const toast = document.getElementById('toast');
    const scoreBar = document.getElementById('score-bar');

    const aminoAcids = ["Ala", "Ser", "Glu", "Lys", "Val", "Thr", "Asp", "Arg", "Leu", "Asn", "Cys", "Pro", "Gly", "Trp"];
    const types = {
      Ala: "hydrophobic", Val: "hydrophobic", Leu: "hydrophobic", Pro: "hydrophobic", Trp: "hydrophobic",
      Ser: "polar", Thr: "polar", Asn: "polar", Gly: "polar",
      Glu: "acidic", Asp: "acidic",
      Lys: "basic", Arg: "basic",
      Cys: "disulfide"
    };

    function createAA(name, i) {
      const el = document.createElement('div');
      el.className = `amino-acid ${types[name]}`;
      el.textContent = name;
      el.id = `aa-${i}`;
      el.dataset.name = name;
      el.dataset.type = types[name];
      el.draggable = true;
      el.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', el.id));
      return el;
    }

    function generateResidues(seed) {
      document.getElementById('daily-seed').textContent = `Puzzle ID: ${seed}`;
      aaBank.innerHTML = '';
      const shuffled = aminoAcids.slice().sort(() => 0.5 - Math.random());
      const set = ["Glu", "Lys"];
      while (set.length < 9) {
        const pick = shuffled[Math.floor(Math.random() * shuffled.length)];
        if (!set.includes(pick)) set.push(pick);
      }
      set.forEach((name, i) => aaBank.appendChild(createAA(name, i)));
    }

    function showToast(msg) {
      toast.textContent = msg;
      toast.className = "show";
      setTimeout(() => toast.className = toast.className.replace("show", ""), 3000);
    }

    function checkStructure() {
      const dropped = [...document.querySelectorAll('.drop-zone .dropped')];
      const acids = dropped.filter(el => el.dataset.type === 'acidic');
      const bases = dropped.filter(el => el.dataset.type === 'basic');
      const hydros = dropped.filter(el => el.dataset.type === 'hydrophobic');
      const polars = dropped.filter(el => el.dataset.type === 'polar');
      const cysteines = dropped.filter(el => el.dataset.name === 'Cys');

      let saltBridges = 0;
      acids.forEach(a => {
        bases.forEach(b => {
          const dist = Math.hypot(a.offsetLeft - b.offsetLeft, a.offsetTop - b.offsetTop);
          const hydrophobicBlock = hydros.some(h => Math.hypot((h.offsetLeft - (a.offsetLeft + b.offsetLeft) / 2), (h.offsetTop - (a.offsetTop + b.offsetTop) / 2)) < 80);
          if (dist < 150 && !hydrophobicBlock) saltBridges++;
        });
      });

      let disulfideBonds = 0;
      for (let i = 0; i < cysteines.length; i++) {
        for (let j = i + 1; j < cysteines.length; j++) {
          const dist = Math.hypot(cysteines[i].offsetLeft - cysteines[j].offsetLeft, cysteines[i].offsetTop - cysteines[j].offsetTop);
          if (dist < 120) disulfideBonds++;
        }
      }

      const deltaG = -2 * hydros.length + polars.length - 3 * saltBridges - 4 * disulfideBonds;
      const rating = deltaG < -12 ? '‚≠ê‚≠ê‚≠ê' : deltaG < -6 ? '‚≠ê‚≠ê' : deltaG < 0 ? '‚≠ê' : 'üß™';
      const percent = Math.min(100, Math.max(0, 50 + deltaG * -5));
      scoreBar.style.background = `linear-gradient(to right, #ef5350 ${percent}%, #eee ${percent}%)`;

      report.innerHTML = `<div class="report-box">
  üî¨ <strong>Lab Report</strong>
  -----------------------------
  Residues placed: ${dropped.map(d => d.dataset.name).join(', ')}
  Salt bridges: ${saltBridges}
  Disulfide bonds: ${disulfideBonds}
  Hydrophobic residues: ${hydros.length}
  Polar residues: ${polars.length}
  ŒîG (folding energy): ${deltaG.toFixed(2)} kcal/mol
  Fold Rating: ${rating}
</div>`;

      showToast(deltaG < -6 ? "Nice Fold!" : "Could be tighter...");
    }

    function resetGame() {
      [...document.querySelectorAll('.dropped')].forEach(el => {
        el.style = '';
        el.classList.remove('dropped');
        el.setAttribute('draggable', true);
        aaBank.appendChild(el);
      });
      report.innerHTML = '';
      scoreBar.style.background = '';
    }

    function nextPuzzle() {
      const newSeed = new Date().getTime().toString();
      resetGame();
      generateResidues(newSeed);
    }

    dropZone.addEventListener('dragover', e => e.preventDefault());
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      const id = e.dataTransfer.getData('text/plain');
      const el = document.getElementById(id);
      el.classList.add('dropped');
      el.style.position = 'absolute';
      el.style.left = `${e.offsetX - 30}px`;
      el.style.top = `${e.offsetY - 30}px`;
      dropZone.appendChild(el);
    });

    window.onload = () => generateResidues("daily-" + new Date().toISOString().split('T')[0]);

    function runDemo() {
      const demoResidues = [
        { name: 'Glu', x: 60, y: 60 },
        { name: 'Lys', x: 120, y: 60 },
        { name: 'Cys', x: 180, y: 60 },
        { name: 'Cys', x: 240, y: 60 },
        { name: 'Ala', x: 300, y: 120 },
        { name: 'Val', x: 180, y: 180 },
        { name: 'Leu', x: 120, y: 240 },
        { name: 'Ser', x: 60, y: 180 },
        { name: 'Thr', x: 120, y: 120 },
      ];

      aaBank.innerHTML = '';
      dropZone.innerHTML = '';
      demoResidues.forEach((res, i) => {
        const el = document.createElement('div');
        el.className = `amino-acid ${types[res.name]}`;
        el.textContent = res.name;
        el.dataset.name = res.name;
        el.dataset.type = types[res.name];
        el.style.position = 'absolute';
        el.style.left = res.x + 'px';
        el.style.top = res.y + 'px';
        el.classList.add('dropped');
        dropZone.appendChild(el);
      });
      setTimeout(() => checkStructure(), 800);
    }
  </script>
</body>
</html>
